(function(f,t,l){function s(d,c,n){d.addEventListener?d.addEventListener(c,n,!1):d.attachEvent("on"+c,n)}function m(d){if("keypress"==d.type){var c=String.fromCharCode(d.which);d.shiftKey||(c=c.toLowerCase());return c}return j[d.which]?j[d.which]:a[d.which]?a[d.which]:String.fromCharCode(d.which).toLowerCase()}function x(d){var c=[];d.shiftKey&&c.push("shift");d.altKey&&c.push("alt");d.ctrlKey&&c.push("ctrl");d.metaKey&&c.push("meta");return c}function o(c){return"shift"==c||"ctrl"==c||"alt"==c||"meta"==c}function i(q,p){var r,v=[];var u=q;"+"===u?u=["+"]:(u=u.replace(/\+{2}/g,"+plus"),u=u.split("+"));for(r=0;r<u.length;++r){var n=u[r];h[n]&&(n=h[n]);p&&"keypress"!=p&&e[n]&&(n=e[n],v.push("shift"));o(n)&&v.push(n)}u=n;r=p;if(!r){if(!g){g={};for(var w in j){95<w&&112>w||j.hasOwnProperty(w)&&(g[j[w]]=w)}}r=g[u]?"keydown":"keypress"}"keypress"==r&&v.length&&(r="keydown");return{key:n,modifiers:v,action:r}}function b(d,c){return null===d||d===t?!1:d===c?!0:b(d.parentNode,c)}function k(H){function F(p){p=p||{};var c=!1,n;for(n in v){p[n]?c=!0:v[n]=0}c||(G=!1)}function B(L,K,M,r,q,I){var n,N=[],p=M.type;if(!A._callbacks[L]){return[]}"keyup"==p&&o(L)&&(K=[L]);for(n=0;n<A._callbacks[L].length;++n){var J=A._callbacks[L][n];if((r||!J.seq||v[J.seq]==J.level)&&p==J.action){var y;(y="keypress"==p&&!M.metaKey&&!M.ctrlKey)||(y=J.modifiers,y=K.sort().join(",")===y.sort().join(","));y&&(y=r&&J.seq==r&&J.level==I,(!r&&J.combo==q||y)&&A._callbacks[L].splice(n,1),N.push(J))}}return N}function D(p,n,r,q){A.stopCallback(n,n.target||n.srcElement,r,q)||!1!==p(n,r)||(n.preventDefault?n.preventDefault():n.returnValue=!1,n.stopPropagation?n.stopPropagation():n.cancelBubble=!0)}function C(n){"number"!==typeof n.which&&(n.which=n.keyCode);var c=m(n);c&&("keyup"==n.type&&E===c?E=!1:A.handleKey(c,x(n),n))}function z(n,r,p,y){function q(K){return function(){G=K;++v[n];clearTimeout(u);u=setTimeout(F,1000)}}function c(K){D(p,K,n);"keyup"!==y&&(E=m(K));setTimeout(F,10)}for(var J=v[n]=0;J<r.length;++J){var I=J+1===r.length?c:q(y||i(r[J+1]).action);w(r[J],I,y,n,J)}}function w(p,n,I,q,y){A._directMap[p+":"+I]=n;p=p.replace(/\s+/g," ");var r=p.split(" ");1<r.length?z(p,r,n,I):(I=i(p,I),A._callbacks[I.key]=A._callbacks[I.key]||[],B(I.key,I.modifiers,{type:I.action},q,p,y),A._callbacks[I.key][q?"unshift":"push"]({callback:n,modifiers:I.modifiers,action:I.action,seq:q,level:y,combo:p}))}var A=this;H=H||t;if(!(A instanceof k)){return new k(H)}A.target=H;A._callbacks={};A._directMap={};var v={},u,E=!1,d=!1,G=!1;A._handleKey=function(n,I,y){var r=B(n,I,y),q;I={};var p=0,c=!1;for(q=0;q<r.length;++q){r[q].seq&&(p=Math.max(p,r[q].level))}for(q=0;q<r.length;++q){r[q].seq?r[q].level==p&&(c=!0,I[r[q].seq]=1,D(r[q].callback,y,r[q].combo,r[q].seq)):c||D(r[q].callback,y,r[q].combo)}r="keypress"==y.type&&d;y.type!=G||o(n)||r||F(I);d=c&&"keydown"==y.type};A._bindMultiple=function(p,n,r){for(var q=0;q<p.length;++q){w(p[q],n,r)}};s(H,"keypress",C);s(H,"keydown",C);s(H,"keyup",C)}if(f){var j={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},a={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},e={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},h={option:"alt",command:"meta","return":"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},g;for(l=1;20>l;++l){j[111+l]="f"+l}for(l=0;9>=l;++l){j[l+96]=l.toString()}k.prototype.bind=function(n,d,p){n=n instanceof Array?n:[n];this._bindMultiple.call(this,n,d,p);return this};k.prototype.unbind=function(d,c){return this.bind.call(this,d,function(){},c)};k.prototype.trigger=function(d,c){if(this._directMap[d+":"+c]){this._directMap[d+":"+c]({},d)}return this};k.prototype.reset=function(){this._callbacks={};this._directMap={};return this};k.prototype.stopCallback=function(n,d){if(-1<(" "+d.className+" ").indexOf(" mousetrap ")||b(d,this.target)){return !1}if("composedPath" in n&&"function"===typeof n.composedPath){var p=n.composedPath()[0];p!==n.target&&(d=p)}return"INPUT"==d.tagName||"SELECT"==d.tagName||"TEXTAREA"==d.tagName||d.isContentEditable};k.prototype.handleKey=function(){return this._handleKey.apply(this,arguments)};k.addKeycodes=function(d){for(var c in d){d.hasOwnProperty(c)&&(j[c]=d[c])}g=null};k.init=function(){var d=k(t),c;for(c in d){"_"!==c.charAt(0)&&(k[c]=function(n){return function(){return d[n].apply(d,arguments)}}(c))}};k.init();f.Mousetrap=k;"undefined"!==typeof module&&module.exports&&(module.exports=k);"function"===typeof define&&define.amd&&define(function(){return k})}})("undefined"!==typeof window?window:null,"undefined"!==typeof window?document:null);